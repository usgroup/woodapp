{% extends 'wrapper.html' %}

{% block content %}



        <div id="main">

            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>


            <div class="page-heading">

                <section class="section"> 

                    <div class="card">
                        <div class="card-header">
                            <h3 class="text">Chiqimlar</h3> 
                            <div class="add-clients-btn d-flex justify-content-end" style="margin-top: -45px;">
                                <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#border-less" >Chiqim turi qo'shish +</a>
                            </div> 
                            
                        </div>
                        <div class="row d-flex justify-content-center">
                            <div class="col-md-3">
                                <div class="form-group">
                                    
                                        
                                <select id="first_select_expense" class="searchable">
                                    <option value="0">Chiqim turi</option>
                                    <option value="2">Komunal to'lovlar</option>
                                    <option value="3">Material uchun</option>
                                    <option value="4">Thomas Edison</option>
                                    <option value="5">Nikola</option>
                                    <option value="6">Selectize</option>
                                    <option value="7">Javascript</option>
                                </select>

                            
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-check form-switch d-flex justify-content-center mt-1" >
                                    <input class="form-check-input fs-4" type="checkbox" id="switchExpense">
                                
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <select id="second_select_expense" class="searchable" disabled>
                                        <option value="0">Ishchilar</option>
                                        <option value="2">Beast</option>
                                        <option value="3">Compatible</option>
                                        <option value="4">Thomas Edison</option>
                                        <option value="5">Nikola</option>
                                        <option value="6">Selectize</option>
                                        <option value="7">Javascript</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row d-flex justify-content-center mt-5 ">
                            <div class="col-md-2">
                                <select class="form-select" id="basicSelect">
                                    <option>Valyutani turi</option>
                                    <option>USD</option>
                                    <option>UZS</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <input type="text" class="form-control" id="basicInput" placeholder="Summa">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <input type="text" class="form-control" id="basicInput" placeholder="Kurs">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <button class="btn btn-success w-100">Tasdiqlash</button>
                                </div>
                            </div>

                            <div class="table-responsive p-5">
                                <table class="table table-bordered mb-0 text-center">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Container</th>
                                            <th>Summa</th>
                                            <th>Chiqim summa</th>
                                            <th>Sotildi</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>#</td>
                                            <td class="text-bold-500">00004</td>
                                            <td>1000 $</td>
                                            <td class="text-bold-500">50 $</td>
                                            <td>500 $</td>
                                            <td>
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="form-check-input form-check-warning form-check-glow " checked="" name="customCheck" id="checkboxGlow6">
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>#</td>
                                            <td class="text-bold-500">00004</td>
                                            <td>1000 $</td>
                                            <td class="text-bold-500">50 $</td>
                                            <td>500 $</td>
                                            <td>
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="form-check-input form-check-warning form-check-glow " checked="" name="customCheck" id="checkboxGlow6">
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>#</td>
                                            <td class="text-bold-500">00004</td>
                                            <td>1000 $</td>
                                            <td class="text-bold-500">50 $</td>
                                            <td>500 $</td>
                                            <td>
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="form-check-input form-check-warning form-check-glow " checked="" name="customCheck" id="checkboxGlow6">
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        
                        
                    </div>

                </section>

            </div>


             <!-- modals -->
<div class="modal fade text-left modal-borderless" id="border-less" tabindex="-1"
role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content" style="height: 500px;">
        <div class="modal-header">
            <h5 class="modal-title">Chiqim turlari</h5>
            <button type="button" class="close rounded-pill" data-bs-dismiss="modal"
                aria-label="Close">
                <i data-feather="x"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="sizeForm">
                {% csrf_token %}
                <div class="row d-flex" >
                    <h6 class="text-danger text-center msg-handle"></h6>
                    <div class="col-md-9">
                        <div class="form-group d-flex justify-content-end">
                            <input type="text" class="form-control" name="expense_type_name" placeholder="Chiqim turi" required>
                           
                        </div>
                    </div>
                    
                    <div class="col-md-2">
                        <button class="btn badge bg-success p-2 mt-1" type="submit" id="addSizeButton">Qo'shish +</button>
                    </div>
                </div>
            </form>
            
            <!-- table -->
            <div class="table-responsive mt-3" style="overflow-y: scroll; max-height:300px;">
                <table class="table table-bordered mb-0 table-expense" id="sizesTable" >
                    <thead>
                        <tr>
                            <th>Chiqim turi nomi</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for s in expense_types %}
                        <tr>
                            <td class="text-bold-500">
                               <div class="sizeInfo-{{ s.id }}">
                               {{ s.title }}
                               </div>
                               <form id='updateSizeForm-{{ s.id }}'>
                                   {% csrf_token %}
                                <div class="row editFormSize-{{ s.id }}" style="display: none;">

                                    <div class="col-md-4">
                                        <input type="text" class="form-control" value="{{ s.title }}" name="expense_type_title">
                                    </div>
                                   
                                    <input type="text" value="{{ s.id }}" name="expense_type_id" style="display: none;">
                                </div>
                                </form>

                            </td>
                            <td class="text-center m-2">
                                <a href="#" onclick="editSize('{{ s.id }}')" id="pensil-edit-{{ s.id }}"><i class="bi bi-pencil-square fs-5 text-warning edit-icon"></i></a>
                                <a href="#" onclick="checkSize('{{ s.id }}')" id="check-edit-{{ s.id }}"style='display:none;' ><i class="bi bi-check-square fs-5 text-success check-icon"></i></a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="modal-footer">
            <button type="button" class="btn btn-light-primary" data-bs-dismiss="modal">
                <i class="bx bx-x d-block d-sm-none"></i>
                <span class="d-none d-sm-block">Orqaga</span>
            </button>
           
        </div>
    </div>
</div>
</div>
<!-- endmodals -->      




<script>

    $(document).ready(function() {
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    
        let csrftoken = getCookie('csrftoken');
    
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/.test(settings.type)) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
        })

   let $select_ = $('select.searchable').selectize()
   let selectize1 = $select_[0].selectize
   let selectize2 = $select_[1].selectize


    $(document).ready(function() {
        $('#switchExpense').on('change', function() {
            if(this.checked){
                selectize1.disable()
                selectize2.enable()

            }else{
                selectize2.disable()
                selectize1.enable()

            }
        });
    });


//expense 


    $(document).ready(function() {
        // Handle form submission with AJAX
        $('#addSizeButton').click(function(event) {
            event.preventDefault();
            let formData = $('#sizeForm').serialize();
    
            let isEmpty = false;
    
           
            $('#sizeForm input').each(function() {
                if ($(this).val().trim() === '') {
                    isEmpty = true;
                    return false; // Break out of the each loop
                }
            });
            
            if (isEmpty) {
                $('.msg-handle').text("Bo'sh bo'lishi mumkin emas !")
                return;
            }
    
            $.ajax({
                type: 'POST',
                url: '{% url "main:add-expense-type" %}', 
                data: formData,
                success: function(response) {
                    
                    let newRow = `
                        <tr>
                            <td class="text-bold-500">
                               <div class="sizeInfo-${ response.data.id }">
                               ${ response.data.title }
                               </div>
                               <form id='updateSizeForm-${ response.data.id } '>
                                   
                                <div class="row editFormSize-${ response.data.id }" style="display: none;">

                                    <div class="col-md-4">
                                        <input type="text" class="form-control" value="${ response.data.title }" name="expense_type_title" id="expense_type_title-${response.data.id}">
                                    </div>
                                   
                                    <input type="text" value=${ response.data.id } name="expense_type_id" style="display:none;" id="expense_type_id-${response.data.id}">
                                </div>
                                </form>

                            </td>
                                <td class="text-center m-2">
                                    <a href="#" onclick="editSize('${ response.data.id }')" id="pensil-edit-${ response.data.id }"><i class="bi bi-pencil-square fs-5 text-warning edit-icon"></i></a>
                                    <a href="#" onclick="checkSize('${ response.data.id }')" id="check-edit-${ response.data.id }"style="display:none;" ><i class="bi bi-check-square fs-5 text-success check-icon"></i></a>
                                </td>
                        </tr>
                    `;
                    
                    // Append the new row to the table body
                    $('.table-expense tbody').append(newRow);
                    $('#sizeForm')[0].reset();
                    $('.msg-handle').text('')

                    $(`.editFormSize-${ response.data.id }`).css({"display":"none"}) 
                    $(`#check-edit-${ response.data.id }`).css({"display":"none"}) 
                    //response = 0
                },
                error: function(error) {
                    alert('Error adding size');
                }
            });
        });
    })
    
        function editSize(id) {
            $(`#pensil-edit-${id}`).css({'display':'none'})
            $(`.sizeInfo-${id}`).css({'display':'none'})
            $(`.editFormSize-${id}`).css({'display':'flex'})
            $(`#check-edit-${id}`).css({'display':'flex'})
            
            
        }

        function checkSize(id){
            $(`#check-edit-${id}`).css({'display':'none'})
            $(`#pensil-edit-${id}`).css({'display':''})
            $(`.sizeInfo-${id}`).css({'display':'flex'})
            $(`.editFormSize-${id}`).css({'display':'none'})

            let updateFormData = $(`#updateSizeForm-${id}`).serialize()
      
            if(updateFormData == ''){
                let getData = {
                    "expense_id": $(`#expense_type_id-${id}`).val(),
                    "expense_type_title": $(`#expense_type_title-${id}`).val()
                }
                
                console.log($(`#expense_type_id-${id}`).val(),  $(`#expense_type_title-${id}`).val())
    
                $.ajax({
                    type: 'GET',
                    url: '{% url "main:edit-expense-type" %}', 
                    data: getData,
                    success: function(response) {
                        
                        $(`.sizeInfo-${id}`).text(response.data.title)
                    
                    },
                    error: function(error) {
                        alert('Error adding size');
                    }
                });
                
            }else{
                $.ajax({
                    type: 'POST',
                    url: '{% url "main:edit-expense-type" %}', 
                    data: updateFormData,
                    success: function(response) {
                        
                        $(`.sizeInfo-${id}`).text(response.data.title)
                    
                    },
                    error: function(error) {
                        alert('Error adding size');
                    }
                });
            }
           


           

        }
    

    
</script>




{% endblock content %}